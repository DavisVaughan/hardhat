<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Subset only required columns — shrink • hardhat</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Subset only required columns — shrink" />

<meta property="og:description" content="shrink() performs a number of validation steps on new_data, and then
subsets it to only contain the required columns. shrink() does the
following validation:
Checks that all required predictor columns exist in new_data.
Checks that the class of each required predictor in new_data is the same
as the class used during training.
Checks that all new_data factor columns don't have any new levels
when compared with the original data used in training. If there are new
levels, they are replaced with NA values and a warning is
issued.
Checks that all new_data factor columns aren't missing any factor levels
when compared with the original data used in training. If there are missing
levels (or misordered levels for ordered factors), then they are restored
and a warning is issued.
" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hardhat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/DavisVaughan/hardhat">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Subset only required columns</h1>
    <small class="dont-index">Source: <a href='https://github.com/DavisVaughan/hardhat/blob/master/R/shrink.R'><code>R/shrink.R</code></a></small>
    <div class="hidden name"><code>shrink.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>shrink()</code> performs a number of validation steps on <code>new_data</code>, and then
subsets it to only contain the required columns. <code>shrink()</code> does the
following validation:</p><ul>
<li><p>Checks that all required predictor columns exist in <code>new_data</code>.</p></li>
<li><p>Checks that the class of each required predictor in <code>new_data</code> is the same
as the class used during training.</p></li>
<li><p>Checks that all <code>new_data</code> factor columns don't have any <em>new</em> levels
when compared with the original data used in training. If there are new
levels, they are replaced with <code>NA</code> values and a warning is
issued.</p></li>
<li><p>Checks that all <code>new_data</code> factor columns aren't missing any factor levels
when compared with the original data used in training. If there are missing
levels (or misordered levels for ordered factors), then they are restored
and a warning is issued.</p></li>
</ul>
    
    </div>

    <pre class="usage"><span class='fu'>shrink</span>(<span class='no'>preprocessor</span>, <span class='no'>new_data</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>preprocessor</th>
      <td><p>A <code>"preprocessor"</code>.</p></td>
    </tr>
    <tr>
      <th>new_data</th>
      <td><p>A data frame containing the new data that will be shrunk down
to only contain the predictors required for preprocessing and prediction.</p></td>
    </tr>
    <tr>
      <th>outcome</th>
      <td><p>A logical. Should the outcome be included in the shrunk
<code>new_data</code> as well?</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A tibble containing the required predictors (and potentially the
outcomes).</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If <code>outcome = TRUE</code>, then the validation steps are performed on the known
outcome column as well, and it is returned along with the predictors. If
<code><a href='mold.html'>mold()</a></code> was called with the XY interface, then no preprocessing was done
to <code>y</code> and <code>outcome</code> cannot be set to <code>TRUE</code> (if a vector was passed as <code>y</code>
during the fit, <code>shrink()</code> has no way of knowing what column in <code>new_data</code>
corresponds to the outcome).</p>
<p><code>shrink()</code> is called by <code><a href='forge.html'>forge()</a></code> before the actual processing is done.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='no'>train</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>[<span class='fl'>1</span>:<span class='fl'>100</span>,]
<span class='no'>test</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>[<span class='fl'>101</span>:<span class='fl'>150</span>,]

<span class='co'># mold() is run at model fit time</span>
<span class='co'># and a terms preprocessor is recorded</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='mold.html'>mold</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Log'>log</a></span>(<span class='no'>Sepal.Width</span>) ~ <span class='no'>Species</span>, <span class='no'>train</span>)

<span class='co'># Pass that preprocessor to shrink(), along with new_data</span>
<span class='co'># to get a tibble of required predictors back</span>
<span class='fu'>shrink</span>(<span class='no'>x</span>$<span class='no'>preprocessor</span>, <span class='no'>test</span>)</div><div class='output co'>#&gt; # A tibble: 50 x 1
#&gt;    Species  
#&gt;    &lt;fct&gt;    
#&gt;  1 virginica
#&gt;  2 virginica
#&gt;  3 virginica
#&gt;  4 virginica
#&gt;  5 virginica
#&gt;  6 virginica
#&gt;  7 virginica
#&gt;  8 virginica
#&gt;  9 virginica
#&gt; 10 virginica
#&gt; # … with 40 more rows</div><div class='input'>
<span class='co'># outcome = TRUE also returns the outcome,</span>
<span class='co'># this can be useful if doing cross validation</span>
<span class='fu'>shrink</span>(<span class='no'>x</span>$<span class='no'>preprocessor</span>, <span class='no'>test</span>, <span class='kw'>outcome</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; # A tibble: 50 x 2
#&gt;    Sepal.Width Species  
#&gt;          &lt;dbl&gt; &lt;fct&gt;    
#&gt;  1         3.3 virginica
#&gt;  2         2.7 virginica
#&gt;  3         3   virginica
#&gt;  4         2.9 virginica
#&gt;  5         3   virginica
#&gt;  6         3   virginica
#&gt;  7         2.5 virginica
#&gt;  8         2.9 virginica
#&gt;  9         2.5 virginica
#&gt; 10         3.6 virginica
#&gt; # … with 40 more rows</div><div class='input'>
<span class='co'># shrink() validates that the classes are the same</span>
<span class='co'># as the ones used in mold(). The below call</span>
<span class='co'># to shrink() will fail with an informative error.</span>
<span class='no'>test2</span> <span class='kw'>&lt;-</span> <span class='no'>test</span>
<span class='no'>test2</span>$<span class='no'>Species</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/character'>as.character</a></span>(<span class='no'>test2</span>$<span class='no'>Species</span>)</div><span class='co'># NOT RUN {</span>
<span class='fu'>shrink</span>(<span class='no'>x</span>$<span class='no'>preprocessor</span>, <span class='no'>test2</span>)
<span class='co'># }</span><div class='input'>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Max Kuhn, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

