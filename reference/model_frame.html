<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Construct a model frame — model_frame • hardhat</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Construct a model frame — model_frame" />

<meta property="og:description" content="model_frame() is a stricter version of stats::model.frame(). There are
a number of differences, with the main being that rows are never dropped
and the return value is a list with the frame and terms separated into
two distinct objects." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hardhat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/forge.html">Forging data for predictions</a>
    </li>
    <li>
      <a href="../articles/mold.html">Molding data for modeling</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/DavisVaughan/hardhat">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Construct a model frame</h1>
    <small class="dont-index">Source: <a href='https://github.com/DavisVaughan/hardhat/blob/master/R/model-frame.R'><code>R/model-frame.R</code></a></small>
    <div class="hidden name"><code>model_frame.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>model_frame()</code> is a stricter version of <code><a href='https://www.rdocumentation.org/packages/stats/topics/model.frame'>stats::model.frame()</a></code>. There are
a number of differences, with the main being that rows are <em>never</em> dropped
and the return value is a list with the frame and terms separated into
two distinct objects.</p>
    
    </div>

    <pre class="usage"><span class='fu'>model_frame</span>(<span class='no'>formula</span>, <span class='no'>data</span>, <span class='kw'>original_levels</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>drop_novel</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>A formula or terms object representing the terms of the
model frame.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A data frame or matrix containing the terms of <code>formula</code>.</p></td>
    </tr>
    <tr>
      <th>original_levels</th>
      <td><p>Optional. A named list of character vectors.
These represent the assumed factor levels for factor columns in <code>data</code>.
If any levels are missing for a factor, then the levels are restored with a
warning. If there are novel levels for a factor, then they are coerced to
<code>NA</code> with a warning.</p></td>
    </tr>
    <tr>
      <th>drop_novel</th>
      <td><p>Optional. A logical. Passed on to
<code><a href='enforce_new_data_novel_levels.html'>enforce_new_data_novel_levels()</a></code>, and only applicable if <code>original_levels</code>
is not <code>NULL</code>. Should novel levels found in <code>new_data</code> but not in
<code>original_levels</code> be coerced to <code>NA</code>? No matter the value of <code>drop_novel</code>,
a warning will be thrown if any novel levels are detected.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A named list with two elements:</p><ul>
<li><p><code>"data"</code>: A tibble containing the model frame.</p></li>
<li><p><code>"terms"</code>: A terms object containing the terms for the model frame.</p></li>
</ul>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The following explains the rationale for some of the difference in arguments
compared to <code><a href='https://www.rdocumentation.org/packages/stats/topics/model.frame'>stats::model.frame()</a></code>:</p><ul>
<li><p><code>subset</code>: Not allowed because the number of rows before and after
<code>model_frame()</code> has been run should always be the same.</p></li>
<li><p><code>na.action</code>: Not allowed and is forced to <code>"na.pass"</code> because the
number of rows before and after <code>model_frame()</code> has been run should always
be the same.</p></li>
<li><p><code>drop.unused.levels</code>: Not allowed because it seems inconsistent for
<code>data</code> and the result of <code>model_frame()</code> to ever have the same factor column
but with different levels, unless specified though <code>original_levels</code>. If
this is required, it should be done through a recipe step explicitly.</p></li>
<li><p><code>...</code>: Not exposed because offsets are handled separately, and
it is not necessary to pass weights here any more because rows are never
dropped (so weights don't have to be subset alongside the rest of the
design matrix). If other non-predictor columns are required, use the
"roles" features of recipes.</p></li>
</ul>
    <p>It is important to always use the results of <code>model_frame()</code> with
<code><a href='model_matrix.html'>model_matrix()</a></code> rather than <code><a href='https://www.rdocumentation.org/packages/stats/topics/model.matrix'>stats::model.matrix()</a></code> because the tibble
in the result of <code>model_frame()</code> does <em>not</em> have a terms object attached.
If <code>model.matrix(&lt;terms&gt;, &lt;tibble&gt;)</code> is called directly, then a call to
<code><a href='https://www.rdocumentation.org/packages/stats/topics/model.frame'>model.frame()</a></code> will be made automatically, which can give faulty results.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># ---------------------------------------------------------------------------</span>
<span class='co'># Example usage</span>

<span class='no'>framed</span> <span class='kw'>&lt;-</span> <span class='fu'>model_frame</span>(<span class='no'>Species</span> ~ <span class='no'>Sepal.Width</span>, <span class='no'>iris</span>)

<span class='no'>framed</span>$<span class='no'>data</span></div><div class='output co'>#&gt; # A tibble: 150 x 2
#&gt;    Species Sepal.Width
#&gt;    &lt;fct&gt;         &lt;dbl&gt;
#&gt;  1 setosa          3.5
#&gt;  2 setosa          3  
#&gt;  3 setosa          3.2
#&gt;  4 setosa          3.1
#&gt;  5 setosa          3.6
#&gt;  6 setosa          3.9
#&gt;  7 setosa          3.4
#&gt;  8 setosa          3.4
#&gt;  9 setosa          2.9
#&gt; 10 setosa          3.1
#&gt; # … with 140 more rows</div><div class='input'>
<span class='no'>framed</span>$<span class='no'>terms</span></div><div class='output co'>#&gt; Species ~ Sepal.Width
#&gt; attr(,"variables")
#&gt; list(Species, Sepal.Width)
#&gt; attr(,"factors")
#&gt;             Sepal.Width
#&gt; Species               0
#&gt; Sepal.Width           1
#&gt; attr(,"term.labels")
#&gt; [1] "Sepal.Width"
#&gt; attr(,"order")
#&gt; [1] 1
#&gt; attr(,"intercept")
#&gt; [1] 1
#&gt; attr(,"response")
#&gt; [1] 1
#&gt; attr(,".Environment")
#&gt; &lt;environment: 0xefc2038&gt;
#&gt; attr(,"predvars")
#&gt; list(Species, Sepal.Width)
#&gt; attr(,"dataClasses")
#&gt;     Species Sepal.Width 
#&gt;    "factor"   "numeric" </div><div class='input'>
<span class='co'># ---------------------------------------------------------------------------</span>
<span class='co'># Missing values never result in dropped rows</span>

<span class='no'>iris2</span> <span class='kw'>&lt;-</span> <span class='no'>iris</span>
<span class='no'>iris2</span>$<span class='no'>Sepal.Width</span>[<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='fl'>NA</span>

<span class='no'>framed2</span> <span class='kw'>&lt;-</span> <span class='fu'>model_frame</span>(<span class='no'>Species</span> ~ <span class='no'>Sepal.Width</span>, <span class='no'>iris2</span>)

<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/head'>head</a></span>(<span class='no'>framed2</span>$<span class='no'>data</span>)</div><div class='output co'>#&gt; # A tibble: 6 x 2
#&gt;   Species Sepal.Width
#&gt;   &lt;fct&gt;         &lt;dbl&gt;
#&gt; 1 setosa         NA  
#&gt; 2 setosa          3  
#&gt; 3 setosa          3.2
#&gt; 4 setosa          3.1
#&gt; 5 setosa          3.6
#&gt; 6 setosa          3.9</div><div class='input'>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>nrow</a></span>(<span class='no'>framed2</span>$<span class='no'>data</span>) <span class='kw'>==</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>nrow</a></span>(<span class='no'>iris2</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># ---------------------------------------------------------------------------</span>
<span class='co'># Novel and missing levels</span>

<span class='no'>train</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/data.frame'>data.frame</a></span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/factor'>factor</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>)))
<span class='no'>test_not_enough</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/data.frame'>data.frame</a></span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/factor'>factor</a></span>(<span class='st'>"a"</span>))
<span class='no'>test_too_many</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/data.frame'>data.frame</a></span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/factor'>factor</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"c"</span>)))
<span class='no'>original_levels</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='get_levels.html'>get_levels</a></span>(<span class='no'>train</span>)

<span class='co'># Missing levels are recovered with a warning</span>
<span class='fu'>model_frame</span>(~<span class='no'>y</span>, <span class='no'>test_not_enough</span>, <span class='no'>original_levels</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: The following original factor levels are missing for column, 'y', and have been restored: 'b'.</span></div><div class='output co'>#&gt; $data
#&gt; # A tibble: 1 x 1
#&gt;   y    
#&gt;   &lt;fct&gt;
#&gt; 1 a    
#&gt; 
#&gt; $terms
#&gt; ~y
#&gt; attr(,"variables")
#&gt; list(y)
#&gt; attr(,"factors")
#&gt;   y
#&gt; y 1
#&gt; attr(,"term.labels")
#&gt; [1] "y"
#&gt; attr(,"order")
#&gt; [1] 1
#&gt; attr(,"intercept")
#&gt; [1] 1
#&gt; attr(,"response")
#&gt; [1] 0
#&gt; attr(,".Environment")
#&gt; &lt;environment: 0xefc2038&gt;
#&gt; attr(,"predvars")
#&gt; list(y)
#&gt; attr(,"dataClasses")
#&gt;        y 
#&gt; "factor" 
#&gt; </div><div class='input'>
<span class='co'># Novel levels are forced to NA with a warning</span>
<span class='fu'>model_frame</span>(~<span class='no'>y</span>, <span class='no'>test_too_many</span>, <span class='no'>original_levels</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: The following factor levels are new for column, `y`, and have been coerced to `NA` : 'c'.</span></div><div class='output co'>#&gt; $data
#&gt; # A tibble: 3 x 1
#&gt;   y    
#&gt;   &lt;fct&gt;
#&gt; 1 a    
#&gt; 2 b    
#&gt; 3 &lt;NA&gt; 
#&gt; 
#&gt; $terms
#&gt; ~y
#&gt; attr(,"variables")
#&gt; list(y)
#&gt; attr(,"factors")
#&gt;   y
#&gt; y 1
#&gt; attr(,"term.labels")
#&gt; [1] "y"
#&gt; attr(,"order")
#&gt; [1] 1
#&gt; attr(,"intercept")
#&gt; [1] 1
#&gt; attr(,"response")
#&gt; [1] 0
#&gt; attr(,".Environment")
#&gt; &lt;environment: 0xefc2038&gt;
#&gt; attr(,"predvars")
#&gt; list(y)
#&gt; attr(,"dataClasses")
#&gt;        y 
#&gt; "factor" 
#&gt; </div><div class='input'>
<span class='fu'>model_frame</span>(~<span class='no'>y</span>, <span class='no'>test_too_many</span>, <span class='no'>original_levels</span>, <span class='kw'>drop_novel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: The following factor levels are new for column, `y`: 'c'.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: The following novel levels were detected in 'y': 'c'. The order of the `original_levels` has been restored, and the novel levels have been moved to the end.</span></div><div class='output co'>#&gt; $data
#&gt; # A tibble: 3 x 1
#&gt;   y    
#&gt;   &lt;fct&gt;
#&gt; 1 a    
#&gt; 2 b    
#&gt; 3 c    
#&gt; 
#&gt; $terms
#&gt; ~y
#&gt; attr(,"variables")
#&gt; list(y)
#&gt; attr(,"factors")
#&gt;   y
#&gt; y 1
#&gt; attr(,"term.labels")
#&gt; [1] "y"
#&gt; attr(,"order")
#&gt; [1] 1
#&gt; attr(,"intercept")
#&gt; [1] 1
#&gt; attr(,"response")
#&gt; [1] 0
#&gt; attr(,".Environment")
#&gt; &lt;environment: 0xefc2038&gt;
#&gt; attr(,"predvars")
#&gt; list(y)
#&gt; attr(,"dataClasses")
#&gt;        y 
#&gt; "factor" 
#&gt; </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Davis Vaughan, Max Kuhn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

