<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Toolkit for the Construction of Modeling Packages • hardhat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="A Toolkit for the Construction of Modeling Packages">
<meta property="og:description" content="Provides infrastructure for building new modeling packages, 
    including functionality around preprocessing, predicting, and validating 
    input.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">hardhat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DavisVaughan/hardhat">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="hardhat" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#hardhat" class="anchor"></a>hardhat</h1></div>
<!-- badges: start -->

<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>hardhat is designed to ease the creation of new modeling packages, while simultaneously promoting good R modeling package standards as laid out by the set of opinionated <a href="https://tidymodels.github.io/model-implementation-principles/">Conventions for R Modeling Packages</a>.</p>
<p>The idea is to take as much of the burden around creating a good interface off the developer as possible, and instead let them focus on writing the core implementation of the model. This benefits not only the developer, but also the user of the modeling package, as the standardization allows users to build a set of “expectations” around what any modeling function should return, and how they should interact with it.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(hardhat)</a></code></pre></div>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of hardhat from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># no you cannot</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"hardhat"</span>)</a></code></pre></div>
<p>And the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"DavisVaughan/hardhat"</span>)</a></code></pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>hardhat will mainly be useful to developers, and it allows you to develop new modeling packages that implement formula, data frame, matrix, and recipes interfaces with ease.</p>
<p>There are a number of useful functions in hardhat, but two of the most important ones are <code><a href="reference/mold.html">mold()</a></code> and <code><a href="reference/forge.html">forge()</a></code>.</p>
<div id="mold" class="section level3">
<h3 class="hasAnchor">
<a href="#mold" class="anchor"></a><code><a href="reference/mold.html">mold()</a></code>
</h3>
<p><code><a href="reference/mold.html">mold()</a></code> readies input data for ingestion into a modeling function. It is to be called from the interface layer of your modeling package. For instance, if you have a top level function called <code>linear_regression()</code> that accepts input from the user, you would call <code><a href="reference/mold.html">mold()</a></code> inside of <code>linear_regression()</code>, before passing on the input to the actual implementation function, which should be separated from the top level interface and might be called <code>linear_regression_impl()</code>.</p>
<p>If your modeling function has a formula interface, <code><a href="reference/mold.html">mold()</a></code> will call <code><a href="https://www.rdocumentation.org/packages/stats/topics/model.frame">model.frame()</a></code> and <code><a href="https://www.rdocumentation.org/packages/stats/topics/model.matrix">model.matrix()</a></code> for you, storing important information such as the predictor factor levels and the class of each predictor and outcome column.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">iris_train &lt;-<span class="st"> </span>iris[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,]</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">iris_test &lt;-<span class="st"> </span>iris[<span class="dv">101</span><span class="op">:</span><span class="dv">150</span>,]</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">processed &lt;-<span class="st"> </span><span class="kw"><a href="reference/mold.html">mold</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(Sepal.Length) <span class="op">~</span><span class="st"> </span>Species <span class="op">+</span><span class="st"> </span>Petal.Width, iris_train)</a></code></pre></div>
<p>The return value of <code><a href="reference/mold.html">mold()</a></code> has three things. The <code>predictors</code>, the <code>outcomes</code>, and a <code>preprocessor</code> that varies based on the interface you are using. Notice that the default behavior for <code><a href="reference/mold.html">mold()</a></code> is to <em>not</em> add an intercept column. This is completely controlled by the <code>intercept</code> argument and not by the formula itself.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">processed<span class="op">$</span>predictors</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; # A tibble: 100 x 4</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;    Speciessetosa Speciesversicolor Speciesvirginica Petal.Width</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;            &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt;  1             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt;  2             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;  3             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;  4             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt;  5             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;  6             1                 0                0         0.4</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;  7             1                 0                0         0.3</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;  8             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt;  9             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; 10             1                 0                0         0.1</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; # … with 90 more rows</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"></a>
<a class="sourceLine" id="cb5-17" data-line-number="17">processed<span class="op">$</span>outcomes</a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; # A tibble: 100 x 1</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt;    `log(Sepal.Length)`</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt;  1                1.63</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt;  2                1.59</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt;  3                1.55</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt;  4                1.53</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt;  5                1.61</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt;  6                1.69</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt;  7                1.53</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt;  8                1.61</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="co">#&gt;  9                1.48</span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="co">#&gt; 10                1.59</span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="co">#&gt; # … with 90 more rows</span></a></code></pre></div>
<p>The preprocessor stores a number of things that are useful to any model when it is time to make predictions on new data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(processed<span class="op">$</span>preprocessor)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; [1] "engine"     "intercept"  "info"       "indicators"</span></a></code></pre></div>
<p>For instance, the original levels and classes of the predictors are stored automatically.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">processed<span class="op">$</span>preprocessor<span class="op">$</span>predictors<span class="op">$</span>levels</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">processed<span class="op">$</span>preprocessor<span class="op">$</span>predictors<span class="op">$</span>classes</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; NULL</span></a></code></pre></div>
<p>There is also an interface for the XY method (providing the predictors and outcome directly to <code>x</code> and <code>y</code>). The preprocessing that occurs here is minimal, but you can add an intercept to <code>x</code> with <code>intercept = TRUE</code>.</p>
<p>Notice how even though <code>y</code> is a vector, the <code>outcomes</code> slot of the return value <em>always</em> holds a tibble. Because <code>y</code> is not a data frame / matrix with existing column names, a default name of <code>".outcome"</code> is used.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">x &lt;-<span class="st"> </span>iris_train[, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Species"</span>, <span class="st">"Petal.Width"</span>)]</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">y &lt;-<span class="st"> </span>iris_train<span class="op">$</span>Sepal.Length</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">processed_xy &lt;-<span class="st"> </span><span class="kw"><a href="reference/mold.html">mold</a></span>(x, y, <span class="dt">intercept =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">processed_xy<span class="op">$</span>predictors</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt; # A tibble: 100 x 3</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;    `(Intercept)` Species Petal.Width</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;            &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  1             1 setosa          0.2</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;  2             1 setosa          0.2</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;  3             1 setosa          0.2</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;  4             1 setosa          0.2</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;  5             1 setosa          0.2</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt;  6             1 setosa          0.4</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt;  7             1 setosa          0.3</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt;  8             1 setosa          0.2</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt;  9             1 setosa          0.2</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; 10             1 setosa          0.1</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt; # … with 90 more rows</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"></a>
<a class="sourceLine" id="cb8-22" data-line-number="22">processed_xy<span class="op">$</span>outcomes</a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt; # A tibble: 100 x 1</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt;    .outcome</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="co">#&gt;  1      5.1</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt;  2      4.9</span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="co">#&gt;  3      4.7</span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="co">#&gt;  4      4.6</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt;  5      5  </span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"><span class="co">#&gt;  6      5.4</span></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="co">#&gt;  7      4.6</span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="co">#&gt;  8      5  </span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34"><span class="co">#&gt;  9      4.4</span></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="co">#&gt; 10      4.9</span></a>
<a class="sourceLine" id="cb8-36" data-line-number="36"><span class="co">#&gt; # … with 90 more rows</span></a></code></pre></div>
<p>Finally, there is an interface for <code>recipes</code>. It calls <code><a href="https://www.rdocumentation.org/packages/recipes/topics/prep">recipes::prep()</a></code> on the recipe for you.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/message">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(recipes))</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">rec &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/recipe">recipe</a></span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Species <span class="op">+</span><span class="st"> </span>Petal.Width, iris_train) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/step_log">step_log</a></span>(Sepal.Length) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/step_dummy">step_dummy</a></span>(Species)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">processed_rec &lt;-<span class="st"> </span><span class="kw"><a href="reference/mold.html">mold</a></span>(rec, iris_train)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">processed_rec<span class="op">$</span>predictors</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; # A tibble: 100 x 3</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt;    Petal.Width Species_versicolor Species_virginica</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;          &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt;  1         0.2                  0                 0</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;  2         0.2                  0                 0</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;  3         0.2                  0                 0</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;  4         0.2                  0                 0</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt;  5         0.2                  0                 0</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt;  6         0.4                  0                 0</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt;  7         0.3                  0                 0</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt;  8         0.2                  0                 0</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt;  9         0.2                  0                 0</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt; 10         0.1                  0                 0</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt; # … with 90 more rows</span></a></code></pre></div>
</div>
<div id="forge" class="section level3">
<h3 class="hasAnchor">
<a href="#forge" class="anchor"></a><code><a href="reference/forge.html">forge()</a></code>
</h3>
<p><code><a href="reference/forge.html">forge()</a></code> takes <code>new_data</code> and applies the same preprocessing steps that happened to the data used in training the model. It is to be called from <code><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict()</a></code>, or potentially from a cross validation function where you will use <code><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict()</a></code> repeatedly to measure performance of different folds or different hyperparameters.</p>
<p>Say you fit a model and called <code><a href="reference/mold.html">mold()</a></code> from your fitting function. When you return the model object, you should attach the <code>preprocessor</code> that you get with the output of <code><a href="reference/mold.html">mold()</a></code> onto the model object (using the model constructor, <code><a href="reference/new_base_model.html">new_base_model()</a></code>, makes this easier to do). Then when you call <code><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict()</a></code> on that model object along with <code>new_data</code>, you should call <code><a href="reference/forge.html">forge()</a></code> inside of the <code><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict()</a></code> method with the stored <code>preprocessor</code> and the <code>new_data</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">processed_test &lt;-<span class="st"> </span><span class="kw"><a href="reference/forge.html">forge</a></span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="dt">preprocessor =</span> processed<span class="op">$</span>preprocessor, </a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="dt">new_data =</span> iris_test,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">  <span class="dt">outcomes =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">)</a></code></pre></div>
<p><code><a href="reference/forge.html">forge()</a></code> always returns a list with two things. The first is a tibble containing the preprocessed <code>predictors</code>. The second is optionally the preprocessed <code>outcomes</code> if you are performing cross validation and used a formula or recipes interface. Because we used the formula interface to generate the <code>processed</code> object, we could set <code>outcomes = TRUE</code> above to also return the processed outcome column.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">processed_test<span class="op">$</span>predictors</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; # A tibble: 50 x 4</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt;    Speciessetosa Speciesversicolor Speciesvirginica Petal.Width</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt;            &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt;  1             0                 0                1         2.5</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt;  2             0                 0                1         1.9</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;  3             0                 0                1         2.1</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;  4             0                 0                1         1.8</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;  5             0                 0                1         2.2</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;  6             0                 0                1         2.1</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;  7             0                 0                1         1.7</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;  8             0                 0                1         1.8</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;  9             0                 0                1         1.8</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; 10             0                 0                1         2.5</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; # … with 40 more rows</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"></a>
<a class="sourceLine" id="cb11-17" data-line-number="17">processed_test<span class="op">$</span>outcomes</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; # A tibble: 50 x 1</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt;    `log(Sepal.Length)`</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt;                  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt;  1                1.84</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt;  2                1.76</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt;  3                1.96</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt;  4                1.84</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt;  5                1.87</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt;  6                2.03</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt;  7                1.59</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt;  8                1.99</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt;  9                1.90</span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt; 10                1.97</span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"><span class="co">#&gt; # … with 40 more rows</span></a></code></pre></div>
<p>The nice thing about <code><a href="reference/forge.html">forge()</a></code> is that the <code>preprocessor</code> remembers a lot of information about what happened at fit time, and keeps the user from shooting themselves in the foot at prediction time.</p>
<p>For instance, each predictor used at fit time has to have the same class at prediction time.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">iris_test_bad &lt;-<span class="st"> </span>iris_test</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co"># Turning Species into a character column rather than</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co"># a factor</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">iris_test_bad<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(iris_test_bad<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="kw"><a href="reference/forge.html">forge</a></span>(processed<span class="op">$</span>preprocessor, iris_test_bad)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; Error: Some columns in `new_data` have an incorrect class:</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; `Species`: `character` should be `factor`.</span></a></code></pre></div>
<p>And each predictor column has to exist in <code>new_data</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># Removing species alltogether</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">iris_test_bad<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw"><a href="reference/forge.html">forge</a></span>(processed<span class="op">$</span>preprocessor, iris_test_bad)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; Error: `new_data` is missing the following required predictors:</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt; Species</span></a></code></pre></div>
<p>And new levels in any of the predictors throw a warning and are coerced to <code>NA</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">iris_test_bad &lt;-<span class="st"> </span>iris</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">iris_test_bad<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(iris_test_bad<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">iris_test_bad<span class="op">$</span>Species[<span class="dv">1</span>] &lt;-<span class="st"> "new_level"</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">iris_test_bad<span class="op">$</span>Species  &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(iris_test_bad<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels</a></span>(iris_test_bad<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; [1] "new_level"  "setosa"     "versicolor" "virginica"</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"></a>
<a class="sourceLine" id="cb14-9" data-line-number="9">processed_bad_test &lt;-<span class="st"> </span><span class="kw"><a href="reference/forge.html">forge</a></span>(processed<span class="op">$</span>preprocessor, iris_test_bad)</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; Warning: The following factor levels are new for column, `Species`, and</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; have been coerced to `NA`: 'new_level'.</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"></a>
<a class="sourceLine" id="cb14-13" data-line-number="13">processed_bad_test<span class="op">$</span>predictors</a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; # A tibble: 150 x 4</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt;    Speciessetosa Speciesversicolor Speciesvirginica Petal.Width</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt;            &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt;  1            NA                NA               NA         0.2</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt;  2             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt;  3             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt;  4             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt;  5             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="co">#&gt;  6             1                 0                0         0.4</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#&gt;  7             1                 0                0         0.3</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"><span class="co">#&gt;  8             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="co">#&gt;  9             1                 0                0         0.2</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="co">#&gt; 10             1                 0                0         0.1</span></a>
<a class="sourceLine" id="cb14-27" data-line-number="27"><span class="co">#&gt; # … with 140 more rows</span></a></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/DavisVaughan/hardhat">https://​github.com/​DavisVaughan/​hardhat</a>
</li>
<li>Report a bug at <br><a href="https://github.com/DavisVaughan/hardhat/issues">https://​github.com/​DavisVaughan/​hardhat/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Davis Vaughan <br><small class="roles"> Author, maintainer </small>  </li>
<li>Max Kuhn <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/DavisVaughan/hardhat"><img src="https://travis-ci.org/DavisVaughan/hardhat.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/gh/DavisVaughan/hardhat?branch=master"><img src="https://codecov.io/gh/DavisVaughan/hardhat/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://cran.r-project.org/package=hardhat"><img src="https://www.r-pkg.org/badges/version/hardhat" alt="CRAN status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Davis Vaughan, Max Kuhn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
